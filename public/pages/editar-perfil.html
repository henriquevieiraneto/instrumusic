<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meu Perfil | InstruMusic</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&display=swap">

<style>
/* ---------------------------------------------------- */
/* CSS REUTILIZADO DO EDITAR-PERFIL (para consist√™ncia) */
/* ---------------------------------------------------- */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
    color: #fff;
}

body {
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: url("https://images.unsplash.com/photo-1511379938547-c1f69419868d?auto=format&fit=crop&w=1920&q=90") center/cover no-repeat fixed;
    position: relative;
    overflow: hidden;
}

#particles-js {
    position: fixed;
    top:0;
    left:0;
    width: 100%;
    height: 100%;
    z-index: 1;
    pointer-events: none;
}

/* Nav Bar (Header) */
nav {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    padding: 16px 32px;
    display: flex;
    justify-content: flex-end;
    gap: 16px;
    z-index: 3;
}
nav a {
    color: #fff;
    text-decoration: none;
    font-weight: 500;
    padding: 8px 16px;
    border-radius: 30px;
    transition: 0.3s;
}
nav a:hover {
    background: rgba(230, 57, 70, 0.3);
    color: #e63946;
}

.container {
    width: 420px;
    max-width: 95%;
    background: rgba(10, 40, 98, 0.35);
    border: 1px solid rgba(255,255,255,0.25);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 30px; /* Reduzido o padding superior */
    box-shadow: 0 12px 30px rgba(0,0,0,0.5);
    z-index: 2;
    text-align: center;
    position: relative;
}

.profile-photo {
    /* Posi√ß√£o no Perfil (n√£o mais flutuando para fora) */
    width: 120px;
    height: 120px;
    margin: 0 auto 20px auto;
} 
.profile-photo img, .profile-photo .placeholder {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid rgba(255,255,255,0.4);
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    background: #2a2a2a;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 48px;
    color: #fff;
}

.container h1 {
    margin-top: 10px; 
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 30px;
    color: #e63946; /* Cor de destaque para o nome */
}

/* Estilos Espec√≠ficos para Exibi√ß√£o de Dados */
.data-entry {
    background: rgba(255,255,255,0.08);
    padding: 15px 20px;
    border-radius: 12px;
    text-align: left;
    margin-bottom: 15px;
    border-left: 5px solid #7bc7ff; /* Linha de destaque */
}
.data-entry strong {
    display: block;
    font-size: 0.9rem;
    color: rgba(255,255,255,0.7);
    margin-bottom: 5px;
    font-weight: 400;
}
.data-entry p {
    font-size: 1.1rem;
    font-weight: 500;
    margin: 0;
    color: #fff;
}
/* Bot√£o de Edi√ß√£o */
.btn-edit {
    display: inline-block;
    width: auto;
    padding: 10px 20px;
    border-radius: 30px;
    background: #e63946;
    font-size: 17px;
    font-weight: 600;
    color: #fff;
    cursor: pointer;
    margin-top: 20px;
    transition: 0.3s;
    text-decoration: none;
}
.btn-edit:hover {
    background: #d62839;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
}

footer {
    text-align: center;
    margin-top: 20px;
    color: rgba(255,255,255,0.5);
    font-size: 0.9rem;
}

@media (max-width: 480px) {
    .container { padding: 30px 20px; }
    nav { padding: 12px 20px; }
}
</style>
</head>
<body>

<canvas id="particles-js"></canvas>

<nav>
    <a href="/public/pages/index.html">Home</a>
    <a href="/public/pages/instrumentos.html">Instrumentos</a>
    <a href="/public/pages/editar-perfil.html" style="background: rgba(230, 57, 70, 0.3); color: #e63946;">Editar</a>
    <a href="#" class="btn-logout">Sair</a> 
</nav>

<div class="container">
    <div class="profile-photo">
        <img id="profileImage" src="" alt="Foto de Perfil" style="display:none;">
        <div class="placeholder" id="profilePlaceholder">üë§</div>
    </div>

    <h1 id="userNameDisplay">Carregando...</h1>
    
    <div id="profileData">
        <div class="data-entry">
            <strong>E-mail</strong>
            <p id="emailDisplay">carregando@instrumusic.com</p>
        </div>
        <div class="data-entry">
            <strong>Data de Cadastro</strong>
            <p id="dateDisplay">-- / -- / ----</p>
        </div>
        <div class="data-entry">
            <strong>Instrumento Principal</strong>
            <p id="instrumentDisplay">N√£o Definido</p>
        </div>
    </div>
    
    <a href="/public/pages/editar-perfil.html" class="btn-edit">
        <i class="ri-edit-line"></i> Editar Minhas Informa√ß√µes
    </a>

</div>

<footer>&copy; 2025 InstruMusic</footer>


<script src="/public/js/auth.js"></script>
<script>
// Chamada para a fun√ß√£o de logout (se estiver no auth.js)
document.querySelector('.btn-logout').addEventListener('click', function(e) {
    e.preventDefault();
    if (typeof realizarLogout === 'function') {
        realizarLogout();
    } else {
        localStorage.removeItem('userToken');
        window.location.href = '/public/pages/index.html';
    }
});


document.addEventListener('DOMContentLoaded', function() {
    // 1. Chama a fun√ß√£o para carregar e exibir os dados do usu√°rio.
    exibirDadosDoPerfil();
    
    // 2. Adiciona o script de part√≠culas para o fundo
    (function(){
        const canvas = document.getElementById('particles-js');
        const ctx = canvas.getContext('2d');
        if(!ctx) return;
        
        let DPR = window.devicePixelRatio || 1;
        let W = 0, H = 0;
        const particles = [];
        const PARTICLE_COUNT = 90;
        const CONNECT_DISTANCE = 120;
        const notes = ["\u266A","\u266B"];
        
        function setSize(){
            DPR = window.devicePixelRatio || 1;
            W = window.innerWidth;
            H = window.innerHeight;
            canvas.style.width = W+'px';
            canvas.style.height = H+'px';
            canvas.width = Math.floor(W*DPR);
            canvas.height = Math.floor(H*DPR);
            ctx.setTransform(DPR,0,0,DPR,0,0);
        }
        
        function Particle(){ this.reset(); }
        Particle.prototype.reset=function(){
            this.x=Math.random()*W;
            this.y=Math.random()*H;
            this.size=Math.random()*16+8;
            this.vx=(Math.random()-0.5)*0.6;
            this.vy=(Math.random()-0.5)*0.6;
            this.alpha=0.3+Math.random()*0.7;
            this.note = notes[Math.floor(Math.random()*notes.length)];
            this.rotation = Math.random()*2*Math.PI;
            this.rotationSpeed = (Math.random()-0.5)*0.02;
        }
        Particle.prototype.update=function(){
            this.x+=this.vx;
            this.y+=this.vy;
            this.rotation += this.rotationSpeed;
            if(this.x<-20) this.x=W+20;
            if(this.x>W+20) this.x=-20;
            if(this.y<-20) this.y=H+20;
            if(this.y>H+20) this.y=-20;
        }
        Particle.prototype.draw=function(){
            ctx.save();
            ctx.globalAlpha=this.alpha;
            ctx.translate(this.x,this.y);
            ctx.rotate(this.rotation);
            ctx.fillStyle="#fff";
            ctx.font=`${this.size}px Arial`;
            ctx.textAlign="center";
            ctx.textBaseline="middle";
            ctx.fillText(this.note,0,0);
            ctx.restore();
        }
        
        function connectParticles(){
            for(let i=0;i<particles.length;i++){
                for(let j=i+1;j<particles.length;j++){
                    const dx=particles[i].x-particles[j].x;
                    const dy=particles[i].y-particles[j].y;
                    const dist=Math.sqrt(dx*dx+dy*dy);
                    if(dist<CONNECT_DISTANCE){
                        ctx.beginPath();
                        ctx.strokeStyle='rgba(255,255,255,'+((1-dist/CONNECT_DISTANCE)*0.25)+')';
                        ctx.lineWidth=1;
                        ctx.moveTo(particles[i].x,particles[i].y);
                        ctx.lineTo(particles[j].x,particles[j].y);
                        ctx.stroke();
                    }
                }
            }
        }
        
        function initParticles(){
            particles.length=0;
            for(let i=0;i<PARTICLE_COUNT;i++) particles.push(new Particle());
        }
        
        let rafId=null;
        function render(){
            ctx.clearRect(0,0,W,H);
            connectParticles();
            for(let p of particles) p.update(), p.draw();
            rafId=requestAnimationFrame(render);
        }
        
        function init(){
            setSize();
            initParticles();
            if(rafId) cancelAnimationFrame(rafId);
            render();
        }
        
        window.addEventListener('resize',function(){
            clearTimeout(window._particles_resize_timeout);
            window._particles_resize_timeout=setTimeout(init,120);
        });
        
        init();
    })();
});


// Fun√ß√£o para carregar e exibir os dados do usu√°rio (similar √† de editar, mas para exibi√ß√£o)
function exibirDadosDoPerfil() {
    const token = localStorage.getItem('userToken');
    if (!token) {
        window.location.href = '/public/pages/entry.html'; // Redireciona se n√£o houver token
        return;
    }

    // Requisi√ß√£o ao endpoint do perfil
    fetch('http://localhost:3000/api/perfil', { 
        method: 'GET',
        headers: {
            'Authorization': 'Bearer ' + token, 
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        }
        if (response.status === 401 && typeof realizarLogout === 'function') {
            realizarLogout(); 
            throw new Error('Sess√£o expirada. Fa√ßa login novamente.');
        }
        throw new Error('Falha ao carregar o perfil.');
    })
    .then(data => {
        // Formata√ß√£o da data (Exemplo)
        const dataCadastro = new Date(data.dataCadastro || Date.now()).toLocaleDateString('pt-BR');

        // Atualiza os elementos na tela
        document.getElementById('userNameDisplay').textContent = data.nome || 'Usu√°rio InstruMusic';
        document.getElementById('emailDisplay').textContent = data.email || 'N/A';
        document.getElementById('dateDisplay').textContent = dataCadastro;
        document.getElementById('instrumentDisplay').textContent = data.instrumentoPrincipal || 'Guitarra'; // Exemplo de dado

        // Atualiza a foto de perfil
        if (data.fotoUrl) {
            document.getElementById('profileImage').src = data.fotoUrl;
            document.getElementById('profileImage').style.display = 'block';
            document.getElementById('profilePlaceholder').style.display = 'none';
        }
    })
    .catch(error => {
        console.error('Erro no carregamento do perfil:', error.message);
        document.getElementById('userNameDisplay').textContent = 'Erro de Carregamento';
    });
}
</script>

</body>
</html>